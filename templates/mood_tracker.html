{% extends "layout.html" %}
{% block content %}
<div class="container mt-5 fade-in-soft">
  <h3 class="mb-4 fw-bold">🧠 Mood Tracker</h3>

  <!-- Mood Form -->
  <form method="POST" class="mb-5 p-4 bg-white rounded shadow-sm">
    <div class="mb-3">
      <label class="form-label fw-semibold">How do you feel today?</label><br>
      <div class="btn-group flex-wrap" role="group">
        {% for mood in ["😊 Happy", "😢 Sad", "😠 Angry", "😰 Anxious", "😌 Calm"] %}
          <input type="radio" class="btn-check" name="mood" id="mood{{ loop.index }}" value="{{ mood }}" required>
          <label class="btn btn-outline-primary mb-1" for="mood{{ loop.index }}">{{ mood }}</label>
        {% endfor %}
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label fw-semibold">Select all emotions you felt:</label><br>
      {% for emotion in ["Tired", "Motivated", "Lonely", "Hopeful", "Frustrated", "Grateful", "Stressed", "Excited"] %}
        <div class="form-check form-check-inline my-1">
          <input class="form-check-input" type="checkbox" name="emotions" value="{{ emotion }}" id="{{ emotion }}">
          <label class="form-check-label badge border rounded-pill px-3 py-2 bg-light text-dark small" for="{{ emotion }}">{{ emotion }}</label>
        </div>
      {% endfor %}
    </div>

    <div>
      <button type="submit" class="btn btn-success w-100">💾 Log Mood</button>
    </div>
  </form>

  <!-- Mood History + Chart -->
  <div class="row">
    <!-- History -->
    <div class="col-md-6">
      <h5 class="mb-3">📋 Mood History</h5>
      {% if logs %}
        {% for log in logs %}
          <div class="card mb-3 shadow-sm hover-shadow-soft">
            <div class="card-body">
              <h5>{{ log.mood }}</h5>
              <p class="mb-1 text-muted small">{{ log.timestamp.strftime('%b %d, %Y - %I:%M %p') }}</p>
              {% if log.emotions %}
                <p class="mb-1">
                  <strong>Emotions:</strong>
                  {% for e in log.emotions.split(", ") %}
                    <span class="badge bg-info text-dark me-1">{{ e }}</span>
                  {% endfor %}
                </p>
              {% endif %}
              <form method="POST" action="{{ url_for('delete_mood', log_id=log.id) }}" onsubmit="return confirm('Are you sure you want to delete this mood entry?');">
                <button type="submit" class="btn btn-sm btn-outline-danger mt-2">🗑️ Delete</button>
              </form>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-muted">No mood logs yet. Start tracking today!</p>
      {% endif %}
    </div>

    <!-- Chart -->
    <div class="col-md-6">
      <h6 class="mb-3">📊 Emotion Overview</h6>
      {% if chart_url %}
        <img src="data:image/png;base64,{{ chart_url }}" class="img-fluid rounded shadow" alt="Emotion Chart">
      {% else %}
        <p class="text-muted">No data yet to show a chart.</p>
        <img src="data:image/png;base64,{{ chart_url }}" class="img-fluid rounded shadow fade-chart" alt="Emotion Chart">
      {% endif %}
    </div>
  </div>
</div>

<!-- Animations & Custom Styles -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<style>
  .fade-in-soft {
    animation: fadeIn 0.6s ease-in-out;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .hover-shadow-soft:hover {
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.08);
    transition: 0.3s ease;
  }
</style>
{% endblock %}
