{% extends "layout.html" %}
{% block content %}

<!-- Animate.css -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

<style>
  body {
    background-color: #ffeef3;
    transition: background-color 0.5s ease;
  }

  h3 {
    font-weight: bold;
    color: #d6336c;
    text-align: center;
  }

  .form-label {
    font-weight: 600;
    color: #c2185b;
  }

  .form-control {
    border-radius: 0.6rem;
    transition: all 0.3s ease;
  }

  .form-control:focus {
    border-color: #f06292;
    box-shadow: 0 0 0 0.15rem rgba(240, 98, 146, 0.25);
  }

  .btn-success {
    background-color: #f48fb1;
    border: none;
    font-weight: 500;
    color: white;
  }

  .btn-success:hover {
    background-color: #f06292;
  }

  .strength-meter {
    height: 6px;
    margin-top: 6px;
    border-radius: 4px;
    transition: width 0.3s ease-in-out;
  }

  .strength-text {
    font-size: 0.9rem;
    margin-top: 5px;
    color: #555;
  }

  .form-container {
    max-width: 600px;
    margin: 0 auto;
    background: white;
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
  }

  a {
    color: #d6336c;
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }
</style>

<div class="container mt-5 animate__animated animate__fadeInUp">
  <div class="form-container">
    <h3 class="mb-4">üîê Reset Your Password</h3>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} animate__animated animate__fadeInDown">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST" autocomplete="off">
      <div class="form-group mb-3">
        <label for="email" class="form-label">Your Email</label>
        <input type="email" name="email" class="form-control" required placeholder="you@example.com">
      </div>

      <div class="form-group mb-3">
        <label for="new_password" class="form-label">New Password</label>
        <input type="password" name="new_password" id="new_password" class="form-control" required placeholder="New Password" oninput="checkPasswordStrength()">
        
        <div class="progress">
          <div id="password-strength-bar" class="strength-meter progress-bar" role="progressbar" style="width: 0%;"></div>
        </div>
        <div id="strength-text" class="strength-text">Enter a password to check strength</div>
      </div>

      <div class="form-group mb-4">
        <label for="confirm_password" class="form-label">Confirm New Password</label>
        <input type="password" name="confirm_password" class="form-control" required placeholder="Confirm Password">
      </div>

      <button type="submit" class="btn btn-success w-100 animate__animated animate__fadeInUp">Change Password</button>
    </form>

    <p class="mt-4 text-center">
      <a href="{{ url_for('login') }}">üîô Back to Login</a>
    </p>
  </div>
</div>

<script>
  function checkPasswordStrength() {
    const password = document.getElementById('new_password').value;
    const strengthBar = document.getElementById('password-strength-bar');
    const strengthText = document.getElementById('strength-text');

    let strength = 0;
    if (password.length > 5) strength++;
    if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
    if (/\d/.test(password)) strength++;
    if (/[\W_]/.test(password)) strength++;

    switch (strength) {
      case 0:
        strengthBar.style.width = "0%";
        strengthBar.className = "strength-meter progress-bar";
        strengthText.innerText = "Enter a password to check strength";
        break;
      case 1:
        strengthBar.style.width = "25%";
        strengthBar.className = "strength-meter progress-bar bg-danger";
        strengthText.innerText = "Weak";
        break;
      case 2:
        strengthBar.style.width = "50%";
        strengthBar.className = "strength-meter progress-bar bg-warning";
        strengthText.innerText = "Medium";
        break;
      case 3:
        strengthBar.style.width = "75%";
        strengthBar.className = "strength-meter progress-bar bg-info";
        strengthText.innerText = "Good";
        break;
      case 4:
        strengthBar.style.width = "100%";
        strengthBar.className = "strength-meter progress-bar bg-success";
        strengthText.innerText = "Strong";
        break;
    }
  }
</script>

{% endblock %}
